<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø¯ÙˆÙ„ Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ - Ú©Ù…Ù¾ÛŒÙ† ØªÙˆÙ„Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#2563EB',
                            dark: '#1E40AF',
                            light: '#3B82F6',
                        },
                    },
                },
            },
        }
    </script>
    <style>
        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 14px;
        }
        .rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; }
        .rank-2 { background: linear-gradient(135deg, #C0C0C0, #808080); color: #000; }
        .rank-3 { background: linear-gradient(135deg, #CD7F32, #8B4513); color: #fff; }
        .my-rank {
            background: linear-gradient(135deg, #2563EB, #1E40AF);
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .updating { animation: pulse 1.5s infinite; }
    </style>
</head>
<body class="bg-gray-50 pb-20 md:pb-0 min-h-screen" dir="rtl">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <!-- Mobile Header -->
        <div class="md:hidden p-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <button onclick="history.back()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        â†’
                    </button>
                    <div>
                        <h1 class="text-lg font-bold text-gray-900">ğŸ† Ø¬Ø¯ÙˆÙ„ Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</h1>
                        <p class="text-xs text-gray-500">Û±Û°Û° Ø´Ø±ÛŒÚ© Ø¨Ø±ØªØ±</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-500" id="lastUpdate">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ...</span>
                    <button onclick="refreshLeaderboard()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        ğŸ”„
                    </button>
                </div>
            </div>
        </div>

        <!-- Desktop Header -->
        <div class="hidden md:block border-b border-gray-200">
            <div class="max-w-6xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center gap-8">
                        <div class="text-xl font-bold text-primary flex items-center gap-2">
                            ğŸ¯ Ù¾Ù†Ù„ Ú©Ù…Ù¾ÛŒÙ†
                        </div>
                        <!-- Desktop Navigation -->
                        <nav class="flex items-center gap-1">
                            <a href="dashboard.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors">
                                ğŸ  Ø®Ø§Ù†Ù‡
                            </a>
                            <a href="leaderboard.html" class="px-4 py-2 rounded-lg text-sm font-medium bg-primary/10 text-primary transition-colors">
                                ğŸ† Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ
                            </a>
                            <a href="spin-wheel.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors">
                                ğŸ° Ú¯Ø±Ø¯ÙˆÙ†Ù‡
                            </a>
                            <a href="birthday-campaign.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors">
                                ğŸ‚ Ú©Ù…Ù¾ÛŒÙ†
                            </a>
                        </nav>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-xs text-gray-500" id="lastUpdateDesktop">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ...</span>
                        <button onclick="refreshLeaderboard()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                            ğŸ”„
                        </button>
                        <a href="profile.html" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary">ğŸ‘¤</div>
                            <span class="text-sm font-medium text-gray-700">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
                        </a>
                        <!-- Language Switcher -->
                        <a href="../en/leaderboard.html" class="px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-100 transition-colors border border-gray-200">
                            ğŸŒ English
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 md:px-6 py-6">
        
        <!-- Campaign Info Banner -->
        <div class="bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 text-white p-4 rounded-xl mb-6 shadow-lg">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-lg font-bold mb-1">ğŸ‚ Ú©Ù…Ù¾ÛŒÙ† ØªÙˆÙ„Ø¯ Ø´Ø±Ú©Ø§</h2>
                    <p class="text-sm opacity-90">Ø¨Ø±Ø§ÛŒ Ø¬ÙˆØ§ÛŒØ² Ø·Ù„Ø§ Ø±Ù‚Ø§Ø¨Øª Ú©Ù†ÛŒØ¯! Û±Û°Û° Ø´Ø±ÛŒÚ© Ø¨Ø±ØªØ± Ø¨Ø±Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯!</p>
                </div>
                <div class="text-left">
                    <div class="text-sm opacity-90 mb-1">Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡</div>
                    <div class="text-2xl font-bold" id="timeRemaining">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
                </div>
            </div>
        </div>

        <!-- My Rank Card -->
        <div class="bg-gradient-to-br from-primary to-primary-dark text-white p-6 rounded-xl mb-6 shadow-lg" id="myRankCard">
            <div class="flex justify-between items-center">
                <div>
                    <div class="text-sm opacity-90 mb-1">Ø±ØªØ¨Ù‡ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§</div>
                    <div class="text-4xl font-bold mb-2" id="myRank">-</div>
                    <div class="text-sm opacity-80" id="myStats">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
                </div>
                <div class="text-left">
                    <div class="text-sm opacity-90 mb-1">Ø¬Ø§ÛŒØ²Ù‡ Ø·Ù„Ø§ÛŒ Ø´Ù…Ø§</div>
                    <div class="text-2xl font-bold mb-1" id="myGoldPrize">-</div>
                    <div class="text-sm opacity-80" id="myGoldValue">-</div>
                </div>
            </div>
        </div>

        <!-- Gold Price Info -->
        <div class="bg-white p-4 rounded-xl mb-6 shadow-sm border border-gray-200">
            <div class="flex justify-between items-center">
                <div>
                    <div class="text-sm text-gray-600 mb-1">Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ ÙØ¹Ù„ÛŒ (Û±Û¸ Ø¹ÛŒØ§Ø±)</div>
                    <div class="text-lg font-bold text-gray-900" id="goldPrice">Û±Û±,Û¸Û³Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†/Ú¯Ø±Ù…</div>
                </div>
                <div class="text-left">
                    <div class="text-sm text-gray-600 mb-1">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¬Ø§ÛŒØ²Ù‡</div>
                    <div class="text-sm font-medium text-gray-700">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒØ§Ù† Ú©Ù…Ù¾ÛŒÙ†</div>
                </div>
            </div>
        </div>

        <!-- Prize Structure -->
        <div class="bg-white p-4 rounded-xl mb-6 shadow-sm">
            <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                ğŸ… Ø³Ø§Ø®ØªØ§Ø± Ø¬ÙˆØ§ÛŒØ²
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <div class="p-3 bg-gradient-to-br from-yellow-50 to-amber-50 rounded-lg border border-yellow-200">
                    <div class="text-xs text-gray-600 mb-1">Ø±ØªØ¨Ù‡ Û±</div>
                    <div class="text-lg font-bold text-yellow-700">Û´ Ú¯Ø±Ù…</div>
                </div>
                <div class="p-3 bg-gradient-to-br from-gray-50 to-slate-50 rounded-lg border border-gray-200">
                    <div class="text-xs text-gray-600 mb-1">Ø±ØªØ¨Ù‡â€ŒÙ‡Ø§ÛŒ Û²-Ûµ</div>
                    <div class="text-lg font-bold text-gray-700">Û² Ú¯Ø±Ù…</div>
                </div>
                <div class="p-3 bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg border border-orange-200">
                    <div class="text-xs text-gray-600 mb-1">Ø±ØªØ¨Ù‡â€ŒÙ‡Ø§ÛŒ Û¶-Û±Û°</div>
                    <div class="text-lg font-bold text-orange-700">Û± Ú¯Ø±Ù…</div>
                </div>
                <div class="p-3 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg border border-blue-200">
                    <div class="text-xs text-gray-600 mb-1">Ø±ØªØ¨Ù‡â€ŒÙ‡Ø§ÛŒ Û±Û±-Û±Û°Û°</div>
                    <div class="text-lg font-bold text-blue-700">Û²Û°Û°-Û¸Û°Û° Ø³ÙˆØª</div>
                </div>
            </div>
        </div>

        <!-- Leaderboard Table -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-bold">Û±Û°Û° Ø´Ø±ÛŒÚ© Ø¨Ø±ØªØ±</h3>
                <div class="flex items-center gap-2">
                    <input type="text" id="searchInput" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø´Ø±ÛŒÚ©..." 
                           class="px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-primary">
                </div>
            </div>
            
            <!-- Desktop Table -->
            <div class="hidden md:block overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Ø±ØªØ¨Ù‡</th>
                            <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Ø´Ø±ÛŒÚ©</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">ØªØ¹Ø¯Ø§Ø¯ Ø³ÙØ§Ø±Ø´</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Ù…ÛŒØ²Ø§Ù† ÙØ±ÙˆØ´</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Ø¬Ø§ÛŒØ²Ù‡ Ø·Ù„Ø§</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardTable" class="divide-y divide-gray-200">
                        <!-- Leaderboard rows will be inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- Mobile Cards -->
            <div class="md:hidden divide-y divide-gray-200" id="leaderboardCards">
                <!-- Leaderboard cards will be inserted here -->
            </div>
        </div>

        <!-- Empty State -->
        <div class="hidden text-center py-16 px-6 bg-white rounded-xl shadow-sm" id="emptyState">
            <div class="text-6xl mb-4">ğŸ“Š</div>
            <h3 class="text-lg mb-2 font-semibold text-gray-900">Ù‡Ù†ÙˆØ² Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</h3>
            <p class="text-gray-600">Ø¨Ø±Ø§ÛŒ Ø¸Ø§Ù‡Ø± Ø´Ø¯Ù† Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø±ÙˆØ¹ Ø¨Ù‡ ÙØ±ÙˆØ´ Ú©Ù†ÛŒØ¯!</p>
        </div>

    </main>

    <!-- Bottom Navigation (Mobile Only) -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around py-2 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] z-50 md:hidden">
        <a href="dashboard.html" class="flex-1 flex flex-col items-center gap-1 p-2 text-gray-500 no-underline transition-colors">
            <span class="text-2xl">ğŸ </span>
            <span class="text-[11px] font-medium">Ø®Ø§Ù†Ù‡</span>
        </a>
        <a href="leaderboard.html" class="flex-1 flex flex-col items-center gap-1 p-2 text-primary no-underline transition-colors">
            <span class="text-2xl">ğŸ†</span>
            <span class="text-[11px] font-medium">Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</span>
        </a>
        <a href="spin-wheel.html" class="flex-1 flex flex-col items-center gap-1 p-2 text-gray-500 no-underline transition-colors">
            <span class="text-2xl">ğŸ°</span>
            <span class="text-[11px] font-medium">Ú¯Ø±Ø¯ÙˆÙ†Ù‡</span>
        </a>
        <a href="birthday-campaign.html" class="flex-1 flex flex-col items-center gap-1 p-2 text-gray-500 no-underline transition-colors">
            <span class="text-2xl">ğŸ‚</span>
            <span class="text-[11px] font-medium">Ú©Ù…Ù¾ÛŒÙ†</span>
        </a>
    </nav>

    <script src="../../birthday-campaign-utils.js"></script>
    <script src="../script.js"></script>
    <script>
        // Same JavaScript as English version, but with Persian text
        const mockLeaderboardData = {
            currentPartnerId: 'P-1001',
            goldPricePerGram: 11830000,
            campaignEndDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
            partners: Array.from({ length: 150 }, (_, i) => ({
                id: `P-${1000 + i}`,
                name: `Ø´Ø±ÛŒÚ© ${1000 + i}`,
                code: `P-${1000 + i}`,
                orders: Math.floor(Math.random() * 50) + 1,
                nmv: Math.floor(Math.random() * 50000000) + 1000000
            }))
        };

        let leaderboardData = [];

        function loadLeaderboard() {
            leaderboardData = BirthdayCampaignUtils.calculateLeaderboard(mockLeaderboardData.partners);
            const top100 = leaderboardData.slice(0, 100);
            const myPartner = leaderboardData.find(p => p.id === mockLeaderboardData.currentPartnerId);
            
            if (myPartner) {
                document.getElementById('myRank').textContent = `#${myPartner.rank}`;
                document.getElementById('myStats').textContent = 
                    `${myPartner.orders} Ø³ÙØ§Ø±Ø´ â€¢ ${formatCurrency(myPartner.nmv)} ØªÙˆÙ…Ø§Ù†`;
                
                const goldPrize = BirthdayCampaignUtils.getGoldPrizeForRank(myPartner.rank);
                document.getElementById('myGoldPrize').textContent = 
                    BirthdayCampaignUtils.formatGoldAmount(goldPrize.grams);
                document.getElementById('myGoldValue').textContent = 
                    `â‰ˆ ${formatCurrency(BirthdayCampaignUtils.calculateCashEquivalent(goldPrize.grams, mockLeaderboardData.goldPricePerGram))} ØªÙˆÙ…Ø§Ù†`;
            }
            
            renderLeaderboard(top100, myPartner);
            const updateTime = `Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${new Date().toLocaleTimeString('fa-IR')}`;
            document.getElementById('lastUpdate').textContent = updateTime;
            const desktopUpdate = document.getElementById('lastUpdateDesktop');
            if (desktopUpdate) desktopUpdate.textContent = updateTime;
        }

        function renderLeaderboard(partners, myPartner) {
            const tableBody = document.getElementById('leaderboardTable');
            const cardsContainer = document.getElementById('leaderboardCards');
            const emptyState = document.getElementById('emptyState');
            
            if (partners.length === 0) {
                tableBody.innerHTML = '';
                cardsContainer.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            tableBody.innerHTML = partners.map(partner => {
                const isMe = myPartner && partner.id === myPartner.id;
                const rankClass = partner.rank === 1 ? 'rank-1' : 
                                 partner.rank === 2 ? 'rank-2' : 
                                 partner.rank === 3 ? 'rank-3' : '';
                const rowClass = isMe ? 'my-rank bg-primary/10' : '';
                
                return `
                    <tr class="${rowClass}">
                        <td class="px-4 py-3">
                            <span class="rank-badge ${rankClass}">${partner.rank}</span>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div class="font-medium">${partner.name}</div>
                            <div class="text-xs text-gray-500">${partner.code}</div>
                        </td>
                        <td class="px-4 py-3 text-left font-medium">${partner.orders}</td>
                        <td class="px-4 py-3 text-left font-bold">${formatCurrency(partner.nmv)}</td>
                        <td class="px-4 py-3 text-left">
                            <div class="font-semibold text-yellow-600">${BirthdayCampaignUtils.formatGoldAmount(partner.goldPrize)}</div>
                            <div class="text-xs text-gray-500">${partner.goldPrizeDescription}</div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            cardsContainer.innerHTML = partners.map(partner => {
                const isMe = myPartner && partner.id === myPartner.id;
                const rankClass = partner.rank === 1 ? 'rank-1' : 
                                 partner.rank === 2 ? 'rank-2' : 
                                 partner.rank === 3 ? 'rank-3' : '';
                const cardClass = isMe ? 'bg-primary/5 border-2 border-primary' : '';
                
                return `
                    <div class="p-4 ${cardClass}">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center gap-3">
                                <span class="rank-badge ${rankClass}">${partner.rank}</span>
                                <div>
                                    <div class="font-medium">${partner.name}</div>
                                    <div class="text-xs text-gray-500">${partner.code}</div>
                                </div>
                            </div>
                            ${isMe ? '<span class="text-xs bg-primary text-white px-2 py-1 rounded">Ø´Ù…Ø§</span>' : ''}
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div>
                                <div class="text-xs text-gray-500">Ø³ÙØ§Ø±Ø´</div>
                                <div class="font-semibold">${partner.orders}</div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500">ÙØ±ÙˆØ´</div>
                                <div class="font-semibold">${formatCurrency(partner.nmv)}</div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500">Ø·Ù„Ø§</div>
                                <div class="font-semibold text-yellow-600">${BirthdayCampaignUtils.formatGoldAmount(partner.goldPrize)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function formatCurrency(amount) {
            return amount.toLocaleString('fa-IR');
        }

        function refreshLeaderboard() {
            const updatingText = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ...';
            document.getElementById('lastUpdate').textContent = updatingText;
            document.getElementById('lastUpdate').classList.add('updating');
            const desktopUpdate = document.getElementById('lastUpdateDesktop');
            if (desktopUpdate) {
                desktopUpdate.textContent = updatingText;
                desktopUpdate.classList.add('updating');
            }
            setTimeout(() => {
                loadLeaderboard();
                document.getElementById('lastUpdate').classList.remove('updating');
                if (desktopUpdate) desktopUpdate.classList.remove('updating');
            }, 1000);
        }

        function updateTimeRemaining() {
            const timeRemaining = BirthdayCampaignUtils.getTimeUntilEnd(mockLeaderboardData.campaignEndDate);
            const timeEl = document.getElementById('timeRemaining');
            
            if (timeRemaining.ended) {
                timeEl.textContent = 'Ú©Ù…Ù¾ÛŒÙ† Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯';
            } else {
                timeEl.textContent = `${timeRemaining.days} Ø±ÙˆØ² ${timeRemaining.hours} Ø³Ø§Ø¹Øª ${timeRemaining.minutes} Ø¯Ù‚ÛŒÙ‚Ù‡`;
            }
        }

        document.getElementById('searchInput')?.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filtered = leaderboardData.slice(0, 100).filter(p => 
                p.name.toLowerCase().includes(searchTerm) || 
                p.code.toLowerCase().includes(searchTerm)
            );
            renderLeaderboard(filtered, leaderboardData.find(p => p.id === mockLeaderboardData.currentPartnerId));
        });

        document.addEventListener('DOMContentLoaded', () => {
            loadLeaderboard();
            updateTimeRemaining();
            setInterval(updateTimeRemaining, 60000);
            setInterval(refreshLeaderboard, 1800000);
        });
    </script>
</body>
</html>

