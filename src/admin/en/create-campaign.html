<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Campaign - Daily Purchase Campaign</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#2563EB',
                            dark: '#1E40AF',
                            light: '#3B82F6',
                        },
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="max-w-7xl mx-auto px-6 py-6">
        <!-- Header -->
        <header class="bg-white rounded-xl p-6 mb-6 shadow-sm">
            <div class="flex justify-between items-center gap-4 flex-wrap">
                <button class="bg-transparent border border-gray-300 px-4 py-2 rounded-lg text-sm cursor-pointer transition-all hover:bg-gray-50" onclick="location.href='dashboard.html'">← Back</button>
                <h1 class="text-2xl font-semibold text-gray-900">Create New Campaign</h1>
                <div class="flex gap-2">
                    <button class="inline-flex items-center gap-2 px-5 py-2.5 bg-gray-100 text-gray-900 rounded-lg font-medium hover:bg-gray-200 transition-colors" id="saveDraft">Save as Draft</button>
                    <button class="inline-flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors shadow-sm hover:shadow-md" id="publishCampaign">Publish Campaign</button>
                </div>
            </div>
        </header>

        <!-- Progress Steps -->
        <div class="flex justify-between mb-8 bg-white p-6 rounded-xl shadow-sm relative">
            <div class="step flex-1 flex flex-col items-center gap-2 relative" data-step="1">
                <div class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-semibold text-base transition-all step-number">1</div>
                <div class="text-sm font-medium text-primary step-label">Basic Info</div>
            </div>
            <div class="step flex-1 flex flex-col items-center gap-2 relative" data-step="2">
                <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center font-semibold text-base transition-all step-number">2</div>
                <div class="text-sm font-medium text-gray-600 step-label">Conditions</div>
            </div>
            <div class="step flex-1 flex flex-col items-center gap-2 relative" data-step="3">
                <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center font-semibold text-base transition-all step-number">3</div>
                <div class="text-sm font-medium text-gray-600 step-label">Participants</div>
            </div>
            <div class="step flex-1 flex flex-col items-center gap-2 relative" data-step="4">
                <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center font-semibold text-base transition-all step-number">4</div>
                <div class="text-sm font-medium text-gray-600 step-label">Review</div>
            </div>
        </div>

        <!-- Form Container -->
        <form id="campaignForm" class="bg-white rounded-xl p-8 shadow-sm">
            
            <!-- Step 1: Basic Information -->
            <div class="form-step block" data-step="1">
                <h2 class="text-2xl font-semibold mb-2">Basic Information</h2>
                
                <div class="mb-6">
                    <label for="campaignName" class="block text-sm font-medium mb-2 text-gray-900">Campaign Name <span class="text-red-500">*</span></label>
                    <input type="text" id="campaignName" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm transition-all focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10" placeholder="Enter campaign name" required>
                    <span class="block text-xs text-gray-500 mt-1">Choose a descriptive name for your campaign</span>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="startDate" class="block text-sm font-medium mb-2 text-gray-900">Start Date <span class="text-red-500">*</span></label>
                        <input type="date" id="startDate" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm transition-all focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10" required>
                    </div>
                    <div>
                        <label for="endDate" class="block text-sm font-medium mb-2 text-gray-900">End Date <span class="text-red-500">*</span></label>
                        <input type="date" id="endDate" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm transition-all focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10" required>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="panel" class="block text-sm font-medium mb-2 text-gray-900">Panel Type <span class="text-red-500">*</span></label>
                    <select id="panel" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm transition-all focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10" required>
                        <option value="">Select panel</option>
                        <option value="partner">Partner (شریک)</option>
                        <option value="snap">Snap</option>
                        <option value="pishkhan">Pishkhan (پیشخوان)</option>
                    </select>
                </div>

                <div class="mb-6">
                    <label for="calculationInterval" class="block text-sm font-medium mb-2 text-gray-900">Reward Calculation Interval <span class="text-red-500">*</span></label>
                    <select id="calculationInterval" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm transition-all focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10" required>
                        <option value="">Select interval</option>
                        <option value="daily">Daily (روزی یک بار)</option>
                        <option value="3days">Every 3 Days</option>
                        <option value="4days">Every 4 Days</option>
                        <option value="5days">Every 5 Days</option>
                        <option value="weekly">Weekly (هفته‌ای یک بار)</option>
                    </select>
                    <div class="mt-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800">
                        ⚠️ This interval will apply to ALL insurance companies in this campaign and cannot be changed after activation
                    </div>
                </div>

                <div class="mb-6">
                    <label for="displaySettings" class="block text-sm font-medium mb-2 text-gray-900">Display Settings</label>
                    <textarea id="displaySettings" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm transition-all focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10 resize-y min-h-[80px]" rows="3" placeholder="Enter display settings and notes"></textarea>
                </div>

                <div class="flex justify-between gap-4 mt-8 pt-6 border-t border-gray-200">
                    <div></div>
                    <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors shadow-sm hover:shadow-md" onclick="nextStep(2)">Next: Add Conditions →</button>
                </div>
            </div>

            <!-- Step 2: Insurance Company Conditions -->
            <div class="form-step hidden" data-step="2">
                <h2 class="text-2xl font-semibold mb-2">Insurance Company Conditions</h2>
                <p class="text-gray-600 mb-6">Add up to 10 insurance companies with specific conditions and rewards</p>

                <div class="flex justify-between items-center mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="font-semibold text-gray-900">
                        Companies Added: <span id="companyCount">0</span> / 10
                    </div>
                    <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors shadow-sm hover:shadow-md" id="addCompany">+ Add Insurance Company</button>
                </div>

                <div id="companiesContainer" class="flex flex-col gap-4 mb-6">
                    <!-- Insurance company cards will be added here -->
                </div>

                <div class="text-center py-12 px-6 text-gray-600 bg-gray-50 rounded-lg block" id="emptyCompanies">
                    <p>No insurance companies added yet. Click "Add Insurance Company" to get started.</p>
                </div>

                <div class="flex justify-between gap-4 mt-8 pt-6 border-t border-gray-200">
                    <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gray-100 text-gray-900 rounded-lg font-medium hover:bg-gray-200 transition-colors" onclick="prevStep(1)">← Previous</button>
                    <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors shadow-sm hover:shadow-md" onclick="nextStep(3)">Next: Add Participants →</button>
                </div>
            </div>

            <!-- Step 3: Participants -->
            <div class="form-step hidden" data-step="3">
                <h2 class="text-2xl font-semibold mb-2">Campaign Participants</h2>
                <p class="text-gray-600 mb-6">Select partners who can participate in this campaign</p>

                <div class="mb-6">
                    <label for="partnerSearch" class="block text-sm font-medium mb-2 text-gray-900">Search Partners</label>
                    <input type="text" id="partnerSearch" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm transition-all focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10" placeholder="Search by partner number or name">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="border border-gray-300 rounded-xl p-4">
                        <h3 class="text-base mb-4 pb-4 border-b border-gray-200 font-semibold">Available Partners</h3>
                        <div id="availablePartners" class="max-h-[400px] overflow-y-auto flex flex-col gap-2">
                            <!-- Available partners will be listed here -->
                        </div>
                    </div>
                    <div class="flex flex-col justify-center gap-4">
                        <button type="button" class="bg-primary text-white border-none p-4 rounded-lg text-lg font-bold cursor-pointer transition-all hover:bg-primary-dark" id="addSelected">→</button>
                        <button type="button" class="bg-primary text-white border-none p-4 rounded-lg text-lg font-bold cursor-pointer transition-all hover:bg-primary-dark" id="removeSelected">←</button>
                    </div>
                    <div class="border border-gray-300 rounded-xl p-4">
                        <h3 class="text-base mb-4 pb-4 border-b border-gray-200 font-semibold">Selected Partners (<span id="selectedCount">0</span>)</h3>
                        <div id="selectedPartners" class="max-h-[400px] overflow-y-auto flex flex-col gap-2">
                            <!-- Selected partners will be listed here -->
                        </div>
                    </div>
                </div>

                <div class="flex justify-between gap-4 mt-8 pt-6 border-t border-gray-200">
                    <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gray-100 text-gray-900 rounded-lg font-medium hover:bg-gray-200 transition-colors" onclick="prevStep(2)">← Previous</button>
                    <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors shadow-sm hover:shadow-md" onclick="nextStep(4)">Next: Review →</button>
                </div>
            </div>

            <!-- Step 4: Review & Publish -->
            <div class="form-step hidden" data-step="4">
                <h2 class="text-2xl font-semibold mb-2">Review Campaign</h2>
                <p class="text-gray-600 mb-6">Review all campaign details before publishing</p>

                <div class="bg-gray-50 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4 pb-4 border-b border-gray-200">Basic Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex flex-col gap-1">
                            <span class="text-xs text-gray-500 font-medium">Campaign Name:</span>
                            <span class="text-sm text-gray-900 font-medium" id="reviewName">-</span>
                        </div>
                        <div class="flex flex-col gap-1">
                            <span class="text-xs text-gray-500 font-medium">Panel:</span>
                            <span class="text-sm text-gray-900 font-medium" id="reviewPanel">-</span>
                        </div>
                        <div class="flex flex-col gap-1">
                            <span class="text-xs text-gray-500 font-medium">Start Date:</span>
                            <span class="text-sm text-gray-900 font-medium" id="reviewStartDate">-</span>
                        </div>
                        <div class="flex flex-col gap-1">
                            <span class="text-xs text-gray-500 font-medium">End Date:</span>
                            <span class="text-sm text-gray-900 font-medium" id="reviewEndDate">-</span>
                        </div>
                        <div class="flex flex-col gap-1">
                            <span class="text-xs text-gray-500 font-medium">Calculation Interval:</span>
                            <span class="text-sm text-gray-900 font-medium" id="reviewInterval">-</span>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4 pb-4 border-b border-gray-200">Insurance Companies & Conditions</h3>
                    <div id="reviewCompanies" class="overflow-x-auto">
                        <!-- Companies table will be generated here -->
                    </div>
                </div>

                <div class="bg-gray-50 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4 pb-4 border-b border-gray-200">Participants</h3>
                    <div class="flex flex-col gap-1">
                        <span class="text-xs text-gray-500 font-medium">Total Partners:</span>
                        <span class="text-sm text-gray-900 font-medium" id="reviewParticipants">0</span>
                    </div>
                </div>

                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4 pb-4 border-b border-blue-200 text-blue-900">Campaign Type String</h3>
                    <p class="text-sm text-blue-800 mb-3">This is the encoded Campaign Type string that will be used for reward calculation:</p>
                    <div class="bg-white border border-blue-300 rounded-lg p-4 mb-3">
                        <code id="reviewCampaignType" class="text-xs text-gray-900 font-mono break-all">-</code>
                    </div>
                    <p class="text-xs text-blue-700 italic">Generated automatically from your campaign configuration</p>
                </div>

                <div class="flex justify-between gap-4 mt-8 pt-6 border-t border-gray-200">
                    <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gray-100 text-gray-900 rounded-lg font-medium hover:bg-gray-200 transition-colors" onclick="prevStep(3)">← Previous</button>
                    <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors shadow-sm hover:shadow-md" id="finalPublish">Publish Campaign</button>
                </div>
            </div>

        </form>
    </div>

    <!-- Modal for Adding Insurance Company -->
    <div id="companyModal" class="hidden fixed top-0 left-0 w-full h-full bg-black/50 z-[1000] items-center justify-center">
        <div class="bg-white rounded-xl w-[90%] max-w-2xl max-h-[90vh] overflow-y-auto shadow-xl">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-semibold">Add Insurance Company</h3>
                <button class="bg-transparent border-none text-3xl text-gray-600 cursor-pointer leading-none p-0 w-8 h-8 hover:text-gray-900" onclick="closeCompanyModal()">&times;</button>
            </div>
            <div class="p-6">
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-900">Insurance Company <span class="text-red-500">*</span></label>
                    <select id="modalCompany" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm transition-all focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10">
                        <option value="">Select company</option>
                        <option value="asia">Asia (آسیا)</option>
                        <option value="saman">Saman (سامان)</option>
                        <option value="razi">Razi (رازی)</option>
                        <option value="iran">Iran (ایران)</option>
                        <option value="parsian">Parsian (پارسیان)</option>
                        <option value="pasargad">Pasargad (پاسارگاد)</option>
                        <option value="alborz">Alborz (البرز)</option>
                        <option value="dana">Dana (دانا)</option>
                        <option value="mellat">Mellat (ملت)</option>
                        <option value="kosar">Kosar (کوثر)</option>
                    </select>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-900">Insurance Category <span class="text-red-500">*</span></label>
                    <div class="flex flex-col gap-2">
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="thirdparty" class="w-[18px] h-[18px] cursor-pointer modal-category">
                            Third-party Liability (ثالث)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="body" class="w-[18px] h-[18px] cursor-pointer modal-category">
                            Body Insurance (بدنه)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="health" class="w-[18px] h-[18px] cursor-pointer modal-category">
                            Health Insurance (درمان)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="fire" class="w-[18px] h-[18px] cursor-pointer modal-category">
                            Fire Insurance (آتش‌سوزی)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="life" class="w-[18px] h-[18px] cursor-pointer modal-category">
                            Life Insurance (عمر)
                        </label>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-900">Insurance Duration <span class="text-red-500">*</span></label>
                    <div class="flex flex-col gap-2">
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="3" class="w-[18px] h-[18px] cursor-pointer modal-duration">
                            3 Months (۳ ماهه)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="6" class="w-[18px] h-[18px] cursor-pointer modal-duration">
                            6 Months (۶ ماهه)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="12" class="w-[18px] h-[18px] cursor-pointer modal-duration">
                            12 Months (۱۲ ماهه)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="any" class="w-[18px] h-[18px] cursor-pointer modal-duration">
                            Any Duration (هر مدتی)
                        </label>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-900">Purchase Type <span class="text-red-500">*</span></label>
                    <div class="flex flex-col gap-2">
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="cash" class="w-[18px] h-[18px] cursor-pointer modal-purchase">
                            Cash (نقدی)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="touch-installment" class="w-[18px] h-[18px] cursor-pointer modal-purchase">
                            Touch Installment (قسطی تاچ)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="checkbox" value="non-touch-installment" class="w-[18px] h-[18px] cursor-pointer modal-purchase">
                            Non-touch Installment (قسطی نان‌تاچ)
                        </label>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-900">Reward Amount (Tomans) <span class="text-red-500">*</span></label>
                    <input type="number" id="modalReward" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm transition-all focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10" placeholder="e.g., 1000000" min="0">
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-900">Reward Calculation Type <span class="text-red-500">*</span></label>
                    <div class="flex flex-col gap-2">
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="radio" name="calculationType" value="first" checked class="w-[18px] h-[18px] cursor-pointer">
                            First Purchase of Day Only (فقط اولین خرید روز)
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-50">
                            <input type="radio" name="calculationType" value="all" class="w-[18px] h-[18px] cursor-pointer">
                            All Purchases in Period (تمام خریدهای دوره)
                        </label>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end gap-2">
                <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gray-100 text-gray-900 rounded-lg font-medium hover:bg-gray-200 transition-colors" onclick="closeCompanyModal()">Cancel</button>
                <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors shadow-sm hover:shadow-md" onclick="saveCompany()">Add Company</button>
            </div>
        </div>
    </div>

    <script src="../../campaign-type-utils.js"></script>
    <script src="../script.js"></script>
    <script src="../campaign-form.js"></script>
</body>
</html>

